
## üîç **Solicitud de Consulta de Estado y Recuperaci√≥n de CDR :**

Este endpoint permite **consultar el estado de procesamiento de documentos electr√≥nicos** y, en caso de estar disponibles, **recuperar el CDR (Constancia de Recepci√≥n)** del comprobante consultado.

### üìå Alcance del Endpoint

La funcionalidad aplica para:

- üìÑ **Comprobantes unitarios** (facturas, boletas, etc.).
- üì¶ **Gu√≠as de remisi√≥n**.
- üìä **Comprobantes agrupados**: tales como **res√∫menes diarios**, **comunicaciones de baja**, entre otros.

> üß† **Importante:** Este endpoint es **esencial** para los documentos de tipo **gu√≠a** o **resumen**, ya que dichos comprobantes, al ser enviados mediante el endpoint de env√≠o (`/send`), **no retornan el CDR de forma inmediata**.

---

### üîÅ Casos Especiales

- ‚ö†Ô∏è En caso un **comprobante unitario** haya retornado un **c√≥digo de error temporal 1033** (indicando que el comprobante fue registrado previamente con otros datos), este endpoint **permitir√° consultar nuevamente su estado**.
- ‚úÖ Si el CDR ya ha sido generado, el sistema lo buscar√° y devolver√° autom√°ticamente **codificado en Base64**.

---

|                            EndPoint                         | M√©todo |   Entorno  |
|:-----------------------------------------------------------:|:------:|:----------:|
|     `https://api.sendfact.com/api/cpe/{document}/status`    |  GET   | Producci√≥n |
|  `https://demo-api.sendfact.com/api/cpe/{document}/status`  |  GET   |    Demo    |

### **Esquema :**

|     Par√°metro   |  Condici√≥n  | Tipo De Dato |              Descripci√≥n              |
|:---------------:|:-----------:|:------------:|:-------------------------------------:|
|    document‚ÑπÔ∏è  | Obligatorio |    String    |   Nombre del documento por consultar.  |

##

|                    **üß™ Ejemplo de Solicitud**                     |
|:-------------------------------------------------------------------:|
| `https://demo-api.sendfact.com/api/cpe/12345678901-01-F001-1/status`|

##

###  **Respuestas Consulta CPE:**

**Estado ACEPTADO (Envio unitario):**

> ‚úÖ **HTTP Response 200 OK**

```json
{
    "message": "La factura F001-1 ha sido aceptada por SUNAT/OSE.",
    "document_status": 1,
    "observations": "[]",
    "xml": "PD94bWwgdmVyc2lvbj0iMS4wIiBlZGluZz0idXRmaX...",
    "cdr": "PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idX..."
}
```

**Estado ACEPTADO (Envio por Resumen):**

> ‚úÖ **HTTP Response 200 OK**

```json
{
    "message": "La boleta B001-1 ha sido aceptada por SUNAT/OSE.",
    "document_status": 1
}
```

**Estado PENDIENTE (Aplica para Gu√≠as de Remision y/o Resumenes)**

> ‚úÖ **HTTP Response 200 OK**

```json
{
    "message": "El resumen diario 12345678901-RC-20250515-00001 a√∫n se encuentra en proceso en SUNAT/OSE. Intente nuevamente m√°s tarde.",
    "document_status": 4
}
```

**Estado FIRMADO:**

> ‚úÖ **HTTP Response 200 OK**

```json
{
    "message": "La boleta F001-1 ha sido firmada y est√° lista para ser enviado a SUNAT.",
    "document_status": 3
}
```

**Estado ANULADO:**

> ‚úÖ **HTTP Response 200 OK**

```json
{
    "message": "La boleta F001-1 ha sido dada de baja correctamente en SUNAT/OSE.",
    "document_status": 2
}
```

**Estado RECHAZADO:**

> ‚úÖ **HTTP Response 200 OK**

```json
{
    "message": "La boleta F001-1 ha sido rechazada por SUNAT.",
    "document_status": 0,
    "error_detail": "Descripci√≥n del motivo del RECHAZO por SUNAT."
}
```

#### **Descripci√≥n Respuesta Par√°metro "document_status" :**

| C√≥digo | Estado    | Descripci√≥n                  |
|:------:|:----------|:-----------------------------|
| 0      | Rechazado | Documento rechazado por SUNAT.|
| 1      | Aceptado  | Documento aceptado por SUNAT o el OSE.|
| 2      | Anulado   | Documento anulado mediante un resumen de anulaci√≥n.|
| 3      | Firmado   | Documento firmado digitalmente, pero a√∫n no enviado.|
| 4      | Pendiente | Documento enviado a SUNAT pero en espera de procesamiento.|
| 5      | Error     | Ocurri√≥ un error en el proceso de env√≠o o validaci√≥n del documento.|

#### **Descripci√≥n Par√°metros Respuesta :**

|   Par√°metro  |                                                            Condici√≥n                                                          |
|:------------:|:-----------------------------------------------------------------------------------------------------------------------------:|
|    message   |          Descripci√≥n del resultado de la operaci√≥n. El mensaje es din√°mico y depende del tipo de comprobante generado.        |
| observations | Contiene las observaciones encontradas en el CDR enviado por SUNAT/OSE, si no existiera observaciones no se muestra el campo. |
|      xml     |                                      XML firmado y validado por SUNAT/OSE en base64.                                          |
|      cdr     |                                 Constancia de recepci√≥n enviado por SUNAT/OSE en base64.                                      |


##### **| üìùüïµÔ∏è Notas Importantes :**
- _Este endpoint puede ser utilizado en cualquier momento para consultar el estado de documentos registrados en el PSE._

- _√öselo tambi√©n como mecanismo de verificaci√≥n ante errores de tipo temporal por parte de SUNAT, para recuperar el CDR de forma proactiva._

- _Es recomendable implementar una l√≥gica de reintento/consulta peri√≥dica en tu sistema para asegurar la trazabilidad de todos los comprobantes._